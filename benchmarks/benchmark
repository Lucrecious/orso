#!/bin/bash

echo -e "Program\t\tExecution Time"
echo -e "-------\t\t--------------"

c_time=""
lua_time=""
python_time=""

# Iterate over all input arguments
for filename in "$@"; do
    # Determine the command based on file extension
    case $filename in
        *.lua)
            language="lua"
            command="lua "
            ;;
        *.py)
            language="python3"
            command="python3 "
            ;;
        *)
            language="C"
            # Check if filename contains a path
            if [[ $filename == */* ]]; then
                command=""
            else
                command="./"
            fi
            ;;
    esac
    
    # Execute the file and capture the output
    output=$($command$filename)

    # Extract the execution time from the output using awk
    time=$(echo "$output" | awk 'END { print $NF }')

    # Store the time in the appropriate variable
    if [ "$language" == "C" ]; then
        c_time=$time
    elif [ "$language" == "lua" ]; then
        lua_time=$time
    elif [ "$language" == "python3" ]; then
        python_time=$time
    fi

    echo -e "$command$filename\t$time sec"
done

echo -e "\nComparisons"
echo -e "-----------"

# Calculate and print the ratios using awk
if [ ! -z "$lua_time" ] && [ ! -z "$c_time" ] && [ "$c_time" != "0" ]; then
    lua_ratio=$(echo "$lua_time $c_time" | awk '{printf "%.2f", $1/$2}')
    echo -e "lua vs C\t\t$lua_ratio"
fi

if [ ! -z "$python_time" ] && [ ! -z "$c_time" ] && [ "$c_time" != "0" ]; then
    python_ratio=$(echo "$python_time $c_time" | awk '{printf "%.2f", $1/$2}')
    echo -e "python3 vs C\t$python_ratio"
fi

